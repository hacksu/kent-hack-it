#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef struct credential {
    char* username;
    char* password;
} CredentialPair;

void PrintCred(CredentialPair *cred) {
    char password[16]; strcpy(password, cred->password);
    printf("Username: %s", cred->username);
    printf("Password: %s\n", password);
}

void CreateCredential(CredentialPair *cred) {
    size_t username_size = 16;
    size_t password_size = 64;
    
    cred->username = malloc(username_size + 1);
    cred->password = malloc(password_size + 1);

    printf("[DEBUG] Username located -> %p\n", cred->username);
    printf("[DEBUG] Password located -> %p\n", cred->password);

    printf("Enter Username: ");
    fgets(cred->username, username_size, stdin);
    printf("Enter Password: ");
    fgets(cred->password, password_size, stdin);
}

typedef struct vault {
    CredentialPair* creds;
    int size;
} CredentialVault;

void PrintVault(CredentialVault *vault) {
    if (vault == NULL) return;
    for (int i = 0; i < vault->size; ++i) {
        PrintCred(&(vault->creds[i]));
    }
}

void AddCredential(CredentialVault *vault) {
    if (vault == NULL) return;
    if (vault->size > 0) {
        printf("[TODO] Dynamic Memory Allocation to Store Multiple CredentialPairs.\n");
        return;
    } else {
        vault->creds = malloc(1);
        ++(vault->size);
    }

    CreateCredential(&(vault->creds[vault->size - 1]));
    printf("Credential Added Successfully!\n");
}

void HelpScreen() {
    puts("-------------------------------------------");
    puts("  add .......... add new password");
    puts("  rm ........... remove password");
    puts("  show-all ..... display vault contents");
    puts("  exit ......... quit program");
    puts("-------------------------------------------");
}

int main() {
    char choice[16];

    CredentialVault vault;
    vault.size = 0;
    
    while (1) {
        printf("> ");
        fgets(choice, sizeof(choice), stdin);
        choice[strcspn(choice, "\n")] = 0;
        
        if (strcmp(choice, "add") == 0) {
            AddCredential(&vault);
        } else if (strcmp(choice, "rm") == 0) {
        } else if (strcmp(choice, "show-all") == 0) {
            PrintVault(&vault);
        } else if (strcmp(choice, "exit") == 0) {
            break;
        } else {
            puts("Unknown option.");
            HelpScreen();
        }
    }
    return 0;
}
// COMPILE: gcc oracle.c -o oracle -fno-stack-protector -no-pie -z execstack
