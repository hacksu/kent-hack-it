// ES Format Inclusions
import { fileURLToPath } from "url";
import express from "express";
import path from "path";
import fs from "fs";

const app = express();
const port = 4444; // change to desired port

// Get the correct directory of the current script
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Allows data to be sent from POST requests
app.use(express.urlencoded({ extended: true }));

// Serve static files from the 'images' folder
app.use('/images', express.static(path.join(__dirname, 'images')));

const blog_database = {
    "0": {
        "blog_title": "The Best Homemade Pizza",
        "blog_description": "Learn how to make delicious homemade pizza with fresh ingredients.",
        "blog_image_src": "homemade_pizza.png",
        "blog_image_name": "Homemade Pizza",
        "blog_image_description": "A cheesy, crispy homemade pizza fresh out of the oven.",
        "blog_text": "Making pizza at home is easier than you think. Start with fresh dough, add your favorite toppings, and bake to perfection!"
    },
    "1": {
        "blog_title": "5-Minute Avocado Toast",
        "blog_description": "A quick and healthy breakfast idea that’s packed with flavor.",
        "blog_image_src": "avocado_toast.png",
        "blog_image_name": "Avocado Toast",
        "blog_image_description": "Crispy toast topped with creamy avocado and a sprinkle of seasoning.",
        "blog_text": "Avocado toast is a simple yet delicious meal. Mash ripe avocado on toasted bread, season with salt, pepper, and a drizzle of olive oil."
    },
    "2": {
        "blog_title": "How to Make the Perfect Burger",
        "blog_description": "Master the art of crafting the perfect homemade burger.",
        "blog_image_src": "cheese_burger.png",
        "blog_image_name": "Juicy Burger",
        "blog_image_description": "A juicy, flavorful burger topped with fresh ingredients.",
        "blog_text": "The secret to a great burger is using high-quality beef, seasoning it well, and cooking it just right for the perfect juicy bite."
    },
    "3": {
        "blog_title": "Refreshing Summer Smoothies",
        "blog_description": "Cool down with these healthy and delicious smoothie recipes.",
        "blog_image_src": "smoothies.png",
        "blog_image_name": "Fruit Smoothie",
        "blog_image_description": "A colorful, refreshing smoothie made with fresh fruits.",
        "blog_text": "Blend together bananas, berries, and yogurt for a refreshing and healthy smoothie. Customize it with your favorite ingredients!"
    },
    "4": {
        "blog_title": "Classic Chocolate Chip Cookies",
        "blog_description": "The ultimate recipe for soft and chewy chocolate chip cookies.",
        "blog_image_src": "chocolate_chip_cookie.png",
        "blog_image_name": "Chocolate Chip Cookies",
        "blog_image_description": "A batch of freshly baked chocolate chip cookies.",
        "blog_text": "Mix butter, sugar, flour, and chocolate chips to create the perfect batch of homemade cookies. Bake until golden brown!"
    },
    "5": {
        "blog_title": "Vegetable Lasagna",
        "blog_description": "A hearty, meatless lasagna packed with delicious vegetables.",
        "blog_image_src": "vegi_lasagna.png",
        "blog_image_name": "Vegetable Lasagna",
        "blog_image_description": "A slice of cheesy, veggie-filled lasagna.",
        "blog_text": "Layer noodles with a mixture of vegetables, ricotta, mozzarella, and marinara sauce to create a mouthwatering vegetarian lasagna."
    },
    "6": {
        "blog_title": "Spicy Tofu Stir Fry",
        "blog_description": "A flavorful and spicy stir-fry with crispy tofu and fresh veggies.",
        "blog_image_src": "spicy_tofu_stir_fry.png",
        "blog_image_name": "Spicy Tofu Stir Fry",
        "blog_image_description": "A vibrant stir-fry filled with vegetables and tofu.",
        "blog_text": "Sauté tofu and your favorite veggies in a spicy sauce made from soy sauce, garlic, and chili paste for a quick and delicious meal."
    },
    "7": {
        "blog_title": "Mango Salsa",
        "blog_description": "A sweet and tangy salsa made with fresh mangoes and lime.",
        "blog_image_src": "mango_salsa.png",
        "blog_image_name": "Mango Salsa",
        "blog_image_description": "A bowl of fresh mango salsa with colorful ingredients.",
        "blog_text": "Combine ripe mangoes, red onion, cilantro, and lime juice to create a refreshing salsa that’s perfect with chips or as a topping for grilled meats."
    },
    "8": {
        "blog_title": "Healthy Banana Pancakes",
        "blog_description": "Fluffy and healthy pancakes made with ripe bananas.",
        "blog_image_src": "banana_pancake.png",
        "blog_image_name": "Banana Pancakes",
        "blog_image_description": "A stack of fluffy banana pancakes with syrup.",
        "blog_text": "Mash ripe bananas and mix with flour, eggs, and baking powder for pancakes that are both healthy and delicious. Serve with syrup and fresh fruit!"
    },
    "9": {
        "blog_title": "Baked Ziti",
        "blog_description": "A comforting Italian dish with pasta, marinara sauce, and melted cheese.",
        "blog_image_src": "ziti.png",
        "blog_image_name": "Baked Ziti",
        "blog_image_description": "A cheesy serving of baked ziti fresh from the oven.",
        "blog_text": "Cook ziti pasta, mix with marinara sauce and cheese, and bake until bubbly and golden for a simple and satisfying dinner."
    },
    "10": {
        "blog_title": "Eggplant Parmesan",
        "blog_description": "A crispy, cheesy eggplant dish that’s a perfect vegetarian main course.",
        "blog_image_src": "egg_plant_parmesan.png",
        "blog_image_name": "Eggplant Parmesan",
        "blog_image_description": "A serving of eggplant parmesan with marinara sauce.",
        "blog_text": "Slice eggplant, bread and fry the pieces, then layer with marinara sauce and cheese for a vegetarian twist on the classic Italian dish."
    },
    "11": {
        "blog_title": "Crispy Fish Tacos",
        "blog_description": "Crispy battered fish served in soft tortillas with a tangy slaw.",
        "blog_image_src": "fish_taco.png",
        "blog_image_name": "Fish Tacos",
        "blog_image_description": "A crispy fish taco topped with cabbage slaw.",
        "blog_text": "Fry fish fillets until crispy, then serve in soft tortillas with a crunchy slaw and a drizzle of creamy sauce."
    },
    "12": {
        "blog_title": "Tomato Basil Soup",
        "blog_description": "A creamy and comforting soup made with fresh tomatoes and basil.",
        "blog_image_src": "tomato_basil.png",
        "blog_image_name": "Tomato Basil Soup",
        "blog_image_description": "A bowl of rich and creamy tomato basil soup.",
        "blog_text": "Simmer fresh tomatoes, garlic, and basil to create a flavorful soup. Blend until smooth and add cream for a rich texture."
    },
    "13": {
        "blog_title": "Homemade Guacamole",
        "blog_description": "A simple and creamy guacamole made with ripe avocados.",
        "blog_image_src": "guacamole.png",
        "blog_image_name": "Guacamole",
        "blog_image_description": "A bowl of creamy guacamole served with chips.",
        "blog_text": "Mash avocados with lime, cilantro, and a bit of onion for a quick and easy dip that’s perfect for parties or snacks."
    },
    "14": {
        "blog_title": "Chicken Caesar Salad",
        "blog_description": "A fresh salad with grilled chicken, romaine lettuce, and creamy Caesar dressing.",
        "blog_image_src": "chicken_caesar_salad.png",
        "blog_image_name": "Caesar Salad",
        "blog_image_description": "A plate of Caesar salad with grilled chicken.",
        "blog_text": "Toss romaine lettuce with homemade Caesar dressing, grilled chicken, croutons, and parmesan for a fresh and filling salad."
    },
    "15": {
        "blog_title": "Chocolate Mousse",
        "blog_description": "A rich and creamy chocolate dessert that’s sure to satisfy your sweet tooth.",
        "blog_image_src": "chocolate_mousse.png",
        "blog_image_name": "Chocolate Mousse",
        "blog_image_description": "A bowl of rich chocolate mousse topped with whipped cream.",
        "blog_text": "Whisk together chocolate, cream, and sugar to create a smooth, velvety mousse. Chill and serve with whipped cream on top."
    },
    "16": {
        "blog_title": "Perfect French Toast",
        "blog_description": "A classic breakfast favorite with a golden crust.",
        "blog_image_src": "french_toast.png",
        "blog_image_name": "French Toast",
        "blog_image_description": "Slices of golden-brown French toast with syrup.",
        "blog_text": "Dip bread in a mixture of eggs, milk, cinnamon, and vanilla, then cook until golden brown. Serve with syrup and fruit."
    },
    "17": {
        "blog_title": "Vegetarian Stir-Fry",
        "blog_description": "A quick and healthy veggie stir-fry with bold flavors.",
        "blog_image_src": "vegi_stir_fry.png",
        "blog_image_name": "Vegetable Stir-Fry",
        "blog_image_description": "A colorful mix of stir-fried vegetables.",
        "blog_text": "Stir-fry fresh vegetables with soy sauce, garlic, and ginger for a delicious and healthy meal."
    },
    "18": {
        "blog_title": "Homemade Meatball Sub",
        "blog_description": "A hearty sandwich filled with flavorful meatballs and sauce.",
        "blog_image_src": "meatball_sub.png",
        "blog_image_name": "Meatball Sub",
        "blog_image_description": "A sandwich stuffed with meatballs and marinara sauce.",
        "blog_text": "Prepare juicy meatballs, simmer them in marinara sauce, and serve on a toasted sub roll with melted cheese."
    },
    "19": {
        "blog_title": "Easy Chicken Alfredo",
        "blog_description": "A creamy and delicious pasta dish with grilled chicken.",
        "blog_image_src": "chicken_alfredo.png",
        "blog_image_name": "Chicken Alfredo",
        "blog_image_description": "A plate of creamy pasta with grilled chicken.",
        "blog_text": "Cook pasta, prepare a creamy Alfredo sauce, and top with grilled chicken for a comforting meal."
    },
    "20": {
        "blog_title": "Ultimate Breakfast Burrito",
        "blog_description": "A satisfying breakfast packed with eggs, bacon, and cheese.",
        "blog_image_src": "breakfast_burrito.png",
        "blog_image_name": "Breakfast Burrito",
        "blog_image_description": "A delicious breakfast burrito with eggs and bacon.",
        "blog_text": "Fill a flour tortilla with scrambled eggs, bacon, cheese, and salsa for the ultimate breakfast burrito."
    },
    "38": { // store flag at this element
        "blog_title": "Krabby Patty Secret Recipe",
        "blog_description": "The Heart and Soul of the Bikini Bottom",
        "blog_image_src": "krabby_patty.png",
        "blog_image_name": "Krabby Patty",
        "blog_image_description": "A delicious sandwich.",
        "blog_text": "KHE{fake_flag}"
    }
}

app.get('/', (req, res) => {
    let htmlTemplate = fs.readFileSync(path.join(__dirname, "index.html"), 'utf8');
    for (let i = 0; i < 21; i++) {
        const blog = blog_database[i];

        let blog_item = `
        <div class="col-lg-4 col-md-6 col-sm-12">
            <div class="card post-card">
                <img src="images/${blog.blog_image_src}" class="card-img-top" alt="Post image">
                <div class="card-body">
                    <h5 class="card-title">${blog.blog_title}</h5>
                    <p class="card-text">
                        ${blog.blog_description}
                    </p>
                    <a href="/blog?id=${i}" class="btn btn-primary">Read More</a>
                </div>
            </div>
        </div>
        {{blog_post_item}}
        `

        htmlTemplate = htmlTemplate.replace("{{blog_post_item}}", blog_item);
    }

    // Send the modified HTML
    res.send(htmlTemplate.replace("{{blog_post_item}}", ""));
});

app.get('/blog', (req, res) => {
    const blogId = req.query.id;

    if (!blogId || !blog_database[blogId]) {
        return res.status(404).send("Blog post not found.");
    }

    // Replace placeholders in the HTML with blog content
    const blog = blog_database[blogId];

    let htmlTemplate = fs.readFileSync(path.join(__dirname, "blog.html"), 'utf8');
    htmlTemplate = htmlTemplate
        .replace("{{blog_title}}", blog.blog_title)
        .replace("{{blog_description}}", blog.blog_description)
        .replace("{{blog_image_src}}", blog.blog_image_src)
        .replace("{{blog_image_name}}", blog.blog_image_name)
        .replace("{{blog_image_description}}", blog.blog_image_description)
        .replace("{{blog_text}}", blog.blog_text);

    // Send the modified HTML
    res.send(htmlTemplate);
});

// listen on all interfaces for networking reasons
app.listen(port, '0.0.0.0', () => {
    console.log(`Site running on http://0.0.0.0:${port}`);
});