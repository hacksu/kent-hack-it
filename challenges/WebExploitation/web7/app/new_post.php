<?php
    session_start();
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>New Post</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .form-container {
      max-width: 700px;
      margin: auto;
      background-color: white;
      padding: 2rem;
      border-radius: 0.75rem;
      box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.1);
    }
    .dark-mode {
      background-color: #212529;
      color: #f8f9fa;
    }
    .light-mode {
      background-color: #f8f9fa;
      color: #212529;
    }
    .mode-toggle-btn {
      position: fixed;
      top: 15px;
      right: 15px;
      z-index: 10;
    }
    .form-container.dark-mode {
      background-color: #343a40;
    }
    .form-container.light-mode {
      background-color: white;
    }
    .btn-outline-secondary, .btn-outline-primary {
      border-color: #adb5bd;
    }
    .btn-success {
      background-color: #28a745;
      border-color: #28a745;
    }
  </style>
</head>
<body id="body" class="light-mode py-5">
  <div class="form-container">
    <h1 class="mb-4 text-center">üìù New Post</h1>
    <form action="add_post.php" method="POST" novalidate>
      <p class="text-end mb-0">What's on your mind <?php echo $_SESSION['username']; ?>?</p>
      <div class="mb-3">
        <label for="title" class="form-label">Title</label>
        <input type="text" name="title" id="title" class="form-control" placeholder="Enter your post title" required>
        <input type="hidden" name="username" value="<?php echo $_SESSION['username']; ?>">
      </div>
      <div class="mb-3">
        <label for="content" class="form-label">Content</label>
        <textarea name="content" id="content" class="form-control" rows="8" placeholder="Write something great..." required></textarea>
      </div>
      <div class="d-flex justify-content-between">
        <a href="/" class="btn btn-outline-secondary">‚Üê Back to Blog</a>
        <button type="submit" class="btn btn-success">Publish</button>
      </div>
    </form>
  </div>

  <button id="mode-toggle" class="btn btn-outline-primary mode-toggle-btn">üåô</button>

  <script>
    // Check for stored theme preference in sessionStorage
    const savedTheme = sessionStorage.getItem('theme');
    if (savedTheme) {
      document.body.classList.remove('light-mode', 'dark-mode');
      document.body.classList.add(savedTheme);
      const formContainer = document.querySelector('.form-container');
      formContainer.classList.add(savedTheme);

      // Update the toggle button icon based on the saved theme
      const toggleButton = document.getElementById('mode-toggle');
      if (savedTheme === 'light-mode') {
        toggleButton.textContent = 'üåô'; // Moon icon for light mode
      } else {
        toggleButton.textContent = 'üåû'; // Sun icon for dark mode
      }
    }

    // Toggle dark and light mode
    const toggleButton = document.getElementById('mode-toggle');
    toggleButton.addEventListener('click', () => {
      const formContainer = document.querySelector('.form-container');
      if (document.body.classList.contains('light-mode')) {
        document.body.classList.remove('light-mode');
        document.body.classList.add('dark-mode');
        formContainer.classList.remove('light-mode');
        formContainer.classList.add('dark-mode');
        toggleButton.textContent = 'üåû'; // Sun icon for light mode
        sessionStorage.setItem('theme', 'dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
        document.body.classList.add('light-mode');
        formContainer.classList.remove('dark-mode');
        formContainer.classList.add('light-mode');
        toggleButton.textContent = 'üåô'; // Moon icon for dark mode
        sessionStorage.setItem('theme', 'light-mode');
      }
    });
  </script>
</body>
</html>