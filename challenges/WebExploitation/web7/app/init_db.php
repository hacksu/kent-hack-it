<?php
// execute this before starting the site
$db = new PDO('sqlite:db/blog.db');
$db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

// Create table if it doesn't exist
$db->exec("CREATE TABLE IF NOT EXISTS posts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    author TEXT NOT NULL,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    created_at TEXT NOT NULL
)");

// Check if table is empty before inserting demo posts
$stmt = $db->query("SELECT COUNT(*) FROM posts");
if ($stmt->fetchColumn() == 0) {
    $posts = [
        ['author' => 'Administrator', 'title' => 'Welcome to My Blog', 'content' => 'This is the first post on my blog. Stay tuned for updates!'],
        ['author' => 'Administrator', 'title' => 'PHP + SQLite', 'content' => 'SQLite makes setting up small PHP projects fast and easy.'],
        ['author' => 'Administrator', 'title' => 'Bootstrap Styling', 'content' => 'Thanks to Bootstrap, this blog is styled quickly and responsively.']
    ];

    $insert = $db->prepare("INSERT INTO posts (author, title, content, created_at) VALUES (:author, :title, :content, datetime('now'))");

    foreach ($posts as $post) {
        $insert->execute([
            ':author' => $post['author'],
            ':title' => $post['title'],
            ':content' => $post['content']
        ]);
    }
}

// Create users table if it doesn't exist
$db->exec("CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT NOT NULL,
    password TEXT NOT NULL,
    created_at TEXT NOT NULL
)");
?>