#!/bin/sh
# Start cron as root in background
service cron start

# Run init_db.php as www-data
su -s /bin/sh www-data -c "php /var/www/html/app/init_db.php"

# create flag.txt file and allow www-data to own it
RUN echo $FLAG > /var/www/html/flag.txt
RUN unset FLAG
chown -R www-data:www-data /var/www/html/

# Drop to www-data to run PHP server
exec su -s /bin/sh www-data -c "php -S 0.0.0.0:8080 -t /var/www/html/app"
tail -f /dev/null # ensures the docker doesnt stop prematurely