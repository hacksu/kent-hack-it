# Use a lightweight PHP image
FROM php:8.2-cli

RUN apt-get update && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /var/www/html/app

# move app code
COPY *.php ./
COPY css/ ./css/
COPY stories/ ./stories/
COPY images/ ./images/

# Adjust ownership so www-data can access the app files
RUN chown -R www-data:www-data /var/www/html/

# Expose the port Flask will run on (default 5000)
EXPOSE 8080

# run as root to finish init steps and start web-app as www-data
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

CMD ["/entrypoint.sh"]